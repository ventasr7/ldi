<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stream Player - Professional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg-main: #09090b;
            --bg-card: #18181b;
            --accent: #ef4444;
        }
        body {
            background-color: var(--bg-main);
            color: #f4f4f5;
            font-family: 'Inter', system-ui, sans-serif;
        }
        .search-bar:focus {
            box-shadow: 0 0 0 2px var(--accent);
        }
        .video-container {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .video-hidden {
            transform: scale(0);
            opacity: 0;
            pointer-events: none;
        }
        .music-grid::-webkit-scrollbar {
            width: 6px;
        }
        .music-grid::-webkit-scrollbar-thumb {
            background: #3f3f46;
            border-radius: 10px;
        }
        .playing-now {
            border-left: 3px solid var(--accent);
            background: rgba(239, 68, 68, 0.1);
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <!-- Header / Barra de Búsqueda -->
    <nav class="p-4 border-b border-zinc-800 flex items-center justify-between bg-zinc-950/50 backdrop-blur-md">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-red-600 rounded flex items-center justify-center">
                <i class="fas fa-wave-square text-white"></i>
            </div>
            <span class="font-bold text-lg hidden sm:block">OpenStream</span>
        </div>

        <div class="flex-1 max-w-xl mx-6">
            <div class="relative">
                <input type="text" id="query" placeholder="Buscar canción o artista..." 
                    class="w-full bg-zinc-900 border-none rounded-lg py-2 pl-10 pr-4 text-sm focus:ring-2 focus:ring-red-500 outline-none">
                <i class="fas fa-search absolute left-3 top-2.5 text-zinc-500"></i>
            </div>
        </div>

        <div class="flex items-center gap-4">
            <button id="toggleView" class="text-zinc-400 hover:text-white text-sm">
                <i class="fas fa-video"></i>
            </button>
        </div>
    </nav>

    <div class="flex flex-1 overflow-hidden">
        <!-- Sidebar / Playlist -->
        <aside class="w-64 border-r border-zinc-800 p-4 hidden md:block overflow-y-auto">
            <h3 class="text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-4">Descubrir</h3>
            <ul class="space-y-2 text-sm">
                <li class="hover:text-red-500 cursor-pointer flex items-center gap-3 p-2 rounded-md"><i class="fas fa-home"></i> Inicio</li>
                <li class="hover:text-red-500 cursor-pointer flex items-center gap-3 p-2 rounded-md"><i class="fas fa-bolt"></i> Tendencias</li>
                <li class="hover:text-red-500 cursor-pointer flex items-center gap-3 p-2 rounded-md"><i class="fas fa-clock"></i> Recientes</li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-6 overflow-y-auto music-grid">
            <div id="status" class="text-zinc-500 text-sm mb-4">Escribe algo para buscar música de YouTube...</div>
            <div id="results" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Los resultados se cargan aquí -->
            </div>
        </main>
    </div>

    <!-- Reproductor Flotante de Video (Ocultable) -->
    <div id="videoWrapper" class="fixed bottom-24 right-6 w-72 aspect-video bg-black rounded-xl overflow-hidden shadow-2xl border border-zinc-700 video-hidden z-50">
        <div id="player"></div>
    </div>

    <!-- Barra de Control Inferior -->
    <footer class="h-24 bg-zinc-950 border-t border-zinc-800 p-4 flex items-center justify-between z-50">
        <div class="flex items-center gap-4 w-1/4">
            <div id="miniThumb" class="w-12 h-12 bg-zinc-800 rounded-md overflow-hidden bg-cover bg-center"></div>
            <div class="flex flex-col truncate">
                <span id="trackTitle" class="text-sm font-medium truncate">No hay selección</span>
                <span id="trackChannel" class="text-xs text-zinc-500 truncate">--</span>
            </div>
        </div>

        <div class="flex flex-col items-center gap-2 flex-1">
            <div class="flex items-center gap-6">
                <button class="text-zinc-500 hover:text-white"><i class="fas fa-random"></i></button>
                <button class="text-zinc-500 hover:text-white"><i class="fas fa-step-backward text-xl"></i></button>
                <button id="mainPlayBtn" class="w-10 h-10 bg-white text-black rounded-full flex items-center justify-center hover:scale-105 transition">
                    <i class="fas fa-play ml-1"></i>
                </button>
                <button class="text-zinc-500 hover:text-white"><i class="fas fa-step-forward text-xl"></i></button>
                <button class="text-zinc-500 hover:text-white"><i class="fas fa-redo"></i></button>
            </div>
            <div class="w-full max-w-md h-1 bg-zinc-800 rounded-full">
                <div id="progressBar" class="h-full bg-red-600 rounded-full transition-all" style="width: 0%"></div>
            </div>
        </div>

        <div class="w-1/4 flex justify-end items-center gap-4">
            <i class="fas fa-volume-down text-zinc-500"></i>
            <div class="w-20 h-1 bg-zinc-800 rounded-full">
                <div class="h-full bg-zinc-400 rounded-full" style="width: 70%"></div>
            </div>
        </div>
    </footer>

    <script>
        let player;
        const queryInput = document.getElementById('query');
        const resultsDiv = document.getElementById('results');
        const statusText = document.getElementById('status');
        const videoWrapper = document.getElementById('videoWrapper');
        const mainPlayBtn = document.getElementById('mainPlayBtn');

        // Cargar YouTube IFrame API
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '100%',
                width: '100%',
                videoId: '',
                playerVars: {
                    'autoplay': 1,
                    'controls': 1,
                    'modestbranding': 1,
                    'rel': 0
                },
                events: {
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        function onPlayerStateChange(event) {
            const icon = mainPlayBtn.querySelector('i');
            if (event.data == YT.PlayerState.PLAYING) {
                icon.className = 'fas fa-pause';
                updateProgress();
            } else {
                icon.className = 'fas fa-play ml-1';
            }
        }

        function updateProgress() {
            if (player && player.getCurrentTime) {
                const perc = (player.getCurrentTime() / player.getDuration()) * 100;
                document.getElementById('progressBar').style.width = perc + '%';
                if (player.getPlayerState() == YT.PlayerState.PLAYING) {
                    setTimeout(updateProgress, 1000);
                }
            }
        }

        // Buscador usando la API pública de sugerencias y búsqueda de YouTube (vía script)
        async function searchYouTube() {
            const text = queryInput.value;
            if (text.length < 2) return;
            
            statusText.innerText = "Buscando en YouTube...";
            resultsDiv.innerHTML = "";

            try {
                // Usamos un servicio de búsqueda alternativo para obtener IDs de YouTube
                // Nota: En entornos restringidos, este fetch suele estar permitido
                const response = await fetch(`https://pipedapi.kavin.rocks/search?q=${encodeURIComponent(text)}&filter=videos`);
                const data = await response.json();

                if (data.items && data.items.length > 0) {
                    statusText.innerText = `Resultados para "${text}"`;
                    data.items.forEach(video => {
                        const card = document.createElement('div');
                        card.className = "bg-zinc-900 rounded-xl p-3 hover:bg-zinc-800 cursor-pointer transition group";
                        card.innerHTML = `
                            <div class="relative aspect-video rounded-lg overflow-hidden mb-3">
                                <img src="${video.thumbnail}" class="w-full h-full object-cover">
                                <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 flex items-center justify-center transition">
                                    <i class="fas fa-play text-white text-2xl"></i>
                                </div>
                                <span class="absolute bottom-1 right-1 bg-black/80 text-[10px] px-1 rounded">${video.duration}</span>
                            </div>
                            <h4 class="text-sm font-semibold truncate mb-1">${video.title}</h4>
                            <p class="text-xs text-zinc-500">${video.uploaderName}</p>
                        `;
                        card.onclick = () => playVideo(video.url.split('v=')[1], video.title, video.uploaderName, video.thumbnail);
                        resultsDiv.appendChild(card);
                    });
                }
            } catch (e) {
                statusText.innerText = "Error de conexión. Intenta con otro término.";
                console.error(e);
            }
        }

        function playVideo(id, title, channel, thumb) {
            if (!player) return;
            player.loadVideoById(id);
            document.getElementById('trackTitle').innerText = title;
            document.getElementById('trackChannel').innerText = channel;
            document.getElementById('miniThumb').style.backgroundImage = `url(${thumb})`;
            
            // Mostrar el reproductor si está oculto la primera vez
            if (videoWrapper.classList.contains('video-hidden')) {
                // videoWrapper.classList.remove('video-hidden');
            }
        }

        // Controles de UI
        queryInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') searchYouTube();
        });

        document.getElementById('toggleView').onclick = () => {
            videoWrapper.classList.toggle('video-hidden');
        };

        mainPlayBtn.onclick = () => {
            const state = player.getPlayerState();
            if (state == YT.PlayerState.PLAYING) player.pauseVideo();
            else player.playVideo();
        };

    </script>
</body>
</html>

